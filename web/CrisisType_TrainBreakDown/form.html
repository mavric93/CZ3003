<script>
    function CrisisInit() {
        document.getElementById("submit").onclick = submitCrisis();
    }
    
    var locationInput = document.getElementById("address");
    var marker;
    var autocomplete = new google.maps.places.Autocomplete(locationInput);
    autocomplete.setComponentRestrictions({country: ['sg']});
    autocomplete.addListener('place_changed', function () {
        var place = autocomplete.getPlace();
        var geometry = place.geometry;
        var lat, lng;
        if (geometry) {
            if (marker) {
                marker.setMap(null);
            }
            marker = plot(map, geometry.location, null, true, null, null);
            //dragDrop and set address to textbox 
            google.maps.event.addListener(marker, "dragend", function (event) {
                lat = event.latLng.lat();
                lng = event.latLng.lng();
                var location = event.latLng;
                convertToAddress(location, function (results, status) {
                    if (status === 'OK') {
                        locationInput.value = results[0].formatted_address;
                    }
                });
            });
            markers.push(marker);
            //display onto the form too
            document.getElementById("latitude").value = marker.getPosition().lat();
            document.getElementById("longitude").value = marker.getPosition().lng();
        }
    });
    function submitCrisis() {
        var url = "http://155.69.149.181:8080/SSAD/CrisisServlet"
        var crisisName = document.getElementById("crisisName").value;
        var address = document.getElementById("address").value;
        var latitude = document.getElementById("latitude").value;
        var longitude = document.getElementById("longitude").value;
        var typeOfAttack = document.getElementById("typeOfAttack").value;
        var radius = document.getElementById("radius").value;
        var description = document.getElementById("description").value;
        var crisistype = document.getElementById("crisistype").value;
        var action = "create";

        var parameter = {
            "radius": radius,
            "crisistype": crisistype,
            "address": address,
            "latitude": latitude,
            "longitude": longitude,
            "description": description,
            "typeOfAttack": typeOfAttack,
            "action": action
        };
        $.ajax({
            type: 'POST',
            url: url,
            data: parameter,
            async: true,
            beforeSend: function (xhr) {
                if (xhr && xhr.overrideMimeType) {
                    xhr.overrideMimeType('application/json;charset=utf-8');
                }
            },
            dataType: 'json',
            success: function (result) {
                //Do stuff with the JSON data
                console.log(result);
            }
        });

    }

</script> 
<div id="form_container">
    <div>
        <table>
            <tr>
                <td><label for="CrisisName">Crisis Name </label></td>
                <td><input type="text" id="crisisName" value="Terrorism" /></td>
            </tr>
            <tr>
                <td><label for="address">Address </label></td>
                <td>
                    <input id="address" type="text" maxlength="255" />
                    <input id="latitude" type="hidden" maxlength="255" />
                    <input id="longitude" type="hidden" maxlength="255" />
                </td>
            </tr>
            <tr>
                <td><label for="typeOfAttack">Type of Attack</label></td>
                <td>
                    <select id="typeOfAttack">
                        <option>Chemical</option>
                        <option>Bomb</option>
                    </select><br/>
                </td>
            </tr>
            <tr>
                <td><label for="radius">Radius</label></td>
                <td><input id="radius" type="text" maxlength="255" /></td>
            </tr>
            <tr>
                <td><label for="Description">Description </label></td>
                <td><textarea id="description"/><br/></td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <input type="hidden" id="crisistype" value="TrainBreakDown" readonly/>
                    <input type="button" onclick="submitCrisis()" value="Submit" />
                </td>
            </tr>
        </table>
    </div>
</div>
